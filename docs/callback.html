<!DOCTYPE html>
<html>
<head>
    <title>Spotify Login Callback</title>
    <script>
        // Extract token from URL fragment and pass to Flutter
        window.addEventListener('load', function() {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            const accessToken = params.get('access_token');
            const expiresIn = params.get('expires_in');
            const error = params.get('error');

            if (error) {
                console.error('OAuth error:', error);
                alert('Login failed: ' + error);
                window.close();
            } else if (accessToken) {
                // Send token back to Flutter app
                const message = {
                    type: 'spotify_callback',
                    access_token: accessToken,
                    expires_in: expiresIn
                };
                
                // Try to communicate with opener window (Flutter app)
                if (window.opener && !window.opener.closed) {
                    window.opener.postMessage(message, '*');
                    window.close();
                } else {
                    // Fallback: redirect to main page with token in URL (project path)
                    window.location.href = '/spotify-ai-music-app/#access_token=' + accessToken + '&expires_in=' + expiresIn;
                }
            }
        });
    </script>
</head>
<body>
    <h1>Processing Spotify login...</h1>
    <p>This window should close automatically.</p>
</body>
</html>
